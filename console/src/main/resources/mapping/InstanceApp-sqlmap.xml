<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias alias="InstanceApp" type="com.taobao.easyweb.console.instance.domain.InstanceApp" />
	<resultMap id="InstanceAppMap" class="InstanceApp">
		<result property="id" column="id" />
		<result property="ip" column="instance_ip" />
		<result property="appName" column="app_name" />
		<result property="instanceName" column="instance_name" />
		<result property="appVersion" column="app_version" />
		<result property="lastCheck" column="last_check" />
		<result property="status" column="status" />
		<result property="gmtCreate" column="GMT_CREATE" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED" jdbcType="DATETIME" />
	</resultMap>

	<sql id="instanceAppDAO.selectField">
		<![CDATA[
		SELECT id,instance_ip,instance_name,app_name,app_version,last_check,status,GMT_CREATE,GMT_MODIFIED FROM ew_console_instapp
		]]>
	</sql>

	
	<select id="instanceAppDAO.queryByApp" parameterClass="string" resultMap="InstanceAppMap">
		<include refid="instanceAppDAO.selectField" />
		<![CDATA[
			where app_name = #appName#
		]]>
	</select>
	<select id="instanceAppDAO.query" parameterClass="InstanceApp" resultMap="InstanceAppMap">
		<include refid="instanceAppDAO.selectField" />
		<dynamic prepend="where">
			<isNotNull prepend="," property="lastCheck">
				last_check = #lastCheck#
			</isNotNull>
			<isNotNull prepend="," property="status">
				status = #status#
			</isNotNull>
			<isNotNull prepend="," property="appName">
				app_name = #appName#
			</isNotNull>
			<isNotNull prepend="," property="instanceName">
				instance_name = #instanceName#
			</isNotNull>
			<isNotNull prepend="," property="ip">
				instance_ip = #ip#
			</isNotNull>
		</dynamic>
	</select>
	

	<update id="instanceAppDAO.update" parameterClass="InstanceApp">
		<![CDATA[
        	update ew_console_instapp set gmt_modified=now()
	 	]]>
		<isNotNull prepend="," property="lastCheck">
			last_check = #lastCheck#
		</isNotNull>
		<isNotNull prepend="," property="status">
			status = #status#
		</isNotNull>
	 	<![CDATA[
	        WHERE ID = #id#
	 	]]>
	</update>
	<insert id="instanceAppDAO.insert" parameterClass="InstanceApp">
	    <![CDATA[
        INSERT INTO ew_console_instapp
        ( 
          instance_ip,
          instance_name,
          app_name,
          app_version,
          last_check,
          status,
          GMT_CREATE,
          GMT_MODIFIED
        ) VALUES (
          #ip#,
          #instanceName#,
          #appName#,
          #appVersion#,
          #lastCheck#,
          #status#,
		  now(),
		  now()
        )
         ]]>
	</insert>
	
	<delete id="instanceAppDAO.delete" parameterClass="InstanceApp">
		<![CDATA[
        	delete from ew_console_instapp 
	 	]]>
	 	<dynamic prepend="where">
			<isNotNull prepend="and" property="ip">
				instance_ip = #ip#
			</isNotNull>
			<isNotNull prepend="and" property="appName">
				app_name = #appName#
			</isNotNull>
			<isNotNull prepend="and" property="appVersion">
				app_version = #appVersion#
			</isNotNull>
			<isNotNull prepend="and" property="instanceName">
				instance_name = #instanceName#
			</isNotNull>
		</dynamic>
	</delete>

</sqlMap>