<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">


<sqlMap>

	<typeAlias alias="SiteMenu" type="com.taobao.usp.domain.SiteMenu" />
	<resultMap id="SiteMenuMap" class="SiteMenu">
		<result property="id" column="id" />
		<result property="parentId" column="parent_id" />
		<result property="title" column="title" />
		<result property="siteCategory" column="site_category" />
		<result property="menuItemId" column="menuitem_id" />
        <result property="parentId" column="parent_id" />
        <result property="appId" column="app_id" />
        <result property="status" column="status" />

		<result property="gmtCreate" column="GMT_CREATE" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED" jdbcType="DATETIME" />
	</resultMap>

	<sql id="siteMenuDAO.selectField">
		<![CDATA[
		SELECT id,parent_id,title,site_category,parent_id,status,app_id,menuitem_id,GMT_CREATE,GMT_MODIFIED FROM usp_site_menu
		]]>
	</sql>

	<select id="siteMenuDAO.queryById" parameterClass="int" resultMap="SiteMenuMap">
		<include refid="siteMenuDAO.selectField" />
		<![CDATA[
			where id = #id#
		]]>
	</select>

	<select id="siteMenuDAO.querySiteMenus" parameterClass="int" resultMap="SiteMenuMap">
        <include refid="siteMenuDAO.selectField" />
		<![CDATA[
			where site_category = #siteCategory#
		]]>
	</select>
    <select id="siteMenuDAO.queryChildren" resultMap="SiteMenuMap" parameterClass="map">
        <include refid="siteMenuDAO.selectField" />
        <![CDATA[
			where site_category = #siteCategory# and parent_id=#parentId#
		]]>
    </select>

    <select id="siteMenuDAO.querySiteMenu" resultMap="SiteMenuMap" parameterClass="SiteMenu">
        <include refid="siteMenuDAO.selectField" />
        <![CDATA[
			where site_category = #siteCategory# and menuitem_id=#menuItemId#
		]]>
    </select>
    <select id="siteMenuDAO.queryMenuApps" resultClass="int">
        <![CDATA[
            select DISTINCT app_id from usp_site_menu where site_category=#siteCategory#
        ]]>
    </select>

    <select id="siteMenuDAO.query" resultMap="SiteMenuMap" parameterClass="SiteMenu">
        <include refid="siteMenuDAO.selectField" />
        <dynamic prepend="where">
            <isNotNull prepend="and" property="siteCategory">
                site_category = #siteCategory#
            </isNotNull>
            <isNotNull prepend="and" property="appId">
                app_id = #appId#
            </isNotNull>
            <isNotNull prepend="and" property="id">
                id=#id#
            </isNotNull>
        </dynamic>
    </select>


	<insert id="siteMenuDAO.insert" parameterClass="SiteMenu">
	    <![CDATA[
        INSERT INTO usp_site_menu
        ( title,  
          parent_id,
          site_category,
          menuitem_id,
          status,
          app_id,
          GMT_CREATE,
          GMT_MODIFIED
        ) VALUES (
          #title#,
          #parentId#,
          #siteCategory#,
          #menuItemId#,
          #status#,
          #appId#,
		  now(),
		  now()
        )
         ]]>
	</insert>
    <delete id="siteMenuDAO.delete" parameterClass="SiteMenu">
        <![CDATA[
            delete from usp_site_menu where site_category=#siteCategory# and menuitem_id=#menuItemId#
        ]]>
    </delete>

    <delete id="siteMenuDAO.deleteSiteAppMenus" parameterClass="map">
        <![CDATA[
            delete from usp_site_menu where site_category=#siteCategory# and app_id=#appId#
        ]]>
    </delete>
</sqlMap>