<?xml version="1.0" encoding="GB2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">


<sqlMap>

	<typeAlias alias="Config" type="com.taobao.usp.domain.ConfigInfo" />
	<resultMap id="ConfigMap" class="Config">
		<result property="id" column="id" />
		<result property="key" column="config_key" />
		<result property="defaultValue" column="default_value" />
		<result property="description" column="description" />
        <result property="moduleId" column="module_id" />
        <result property="group" column="config_group" />
        <result property="valueType" column="value_type" />
        <result property="inputType" column="input_type" />
		<result property="inputTypeConfig" column="input_type_config" />
        <result property="type" column="type" />
		<result property="gmtCreate" column="GMT_CREATE" jdbcType="DATETIME" />
		<result property="gmtModified" column="GMT_MODIFIED" jdbcType="DATETIME" />
	</resultMap>

	<sql id="configDAO.selectField">
		<![CDATA[
		SELECT id,config_key,default_value,description,module_id,input_type_config,type,config_group,value_type,input_type,GMT_CREATE,GMT_MODIFIED FROM usp_config
		]]>
	</sql>

	<select id="configDAO.queryByKey" parameterClass="string" resultMap="ConfigMap">
		<include refid="configDAO.selectField" />
		<![CDATA[
			where config_key = #key#
		]]>
	</select>
	
	<select id="configDAO.queryModuleConfigs" resultMap="ConfigMap">
		<include refid="configDAO.selectField" />
        <![CDATA[
			where module_id = #moduleId# order by config_group
		]]>
	</select>
    <select id="configDAO.query" resultMap="ConfigMap" parameterClass="Config">
        <include refid="configDAO.selectField" />
        <dynamic prepend="where">
            <isNotNull prepend="and" property="moduleId">
                module_id = #moduleId#
            </isNotNull>
            <isNotNull prepend="and" property="key">
                config_key = #key#
            </isNotNull>
            <isNotNull prepend="and" property="group">
                config_group = #group#
            </isNotNull>
        </dynamic>
    </select>
    <select id="configDAO.queryModuleConfigGroups" resultClass="string">
        <![CDATA[
			select config_group from usp_config where module_id = #moduleId#
		]]>
    </select>



	<insert id="configDAO.insert" parameterClass="Config">
	    <![CDATA[
        INSERT INTO usp_config
        (
          config_key,
          default_value,
          description,
          module_id,
          config_group,
          value_type,
          input_type,
          input_type_config,
          type,
          GMT_CREATE,
          GMT_MODIFIED
        ) VALUES (
          #key#,
          #defaultValue#,
          #description#,
          #moduleId#,
          #group#,
          #valueType#,
          #inputType#,
          #inputTypeConfig#,
          #type#,
		  now(),
		  now()
        )
         ]]>
	</insert>

    <update id="configDAO.update" parameterClass="Config">
        <![CDATA[
            update usp_config set gmt_modified = now()
        ]]>
        <isNotNull prepend="," property="defaultValue">
            default_value = #defaultValue#
        </isNotNull>
        <isNotNull prepend="," property="group">
            config_group = #group#
        </isNotNull>
        <isNotNull prepend="," property="valueType">
            value_type = #valueType#
        </isNotNull>
        <isNotNull prepend="," property="inputType">
            input_type = #inputType#
        </isNotNull>
        <isNotNull prepend="," property="description">
            description = #description#
        </isNotNull>
        <isNotNull prepend="," property="inputTypeConfig">
            input_type_config = #inputTypeConfig#
        </isNotNull>
        <isNotNull prepend="," property="type">
            type = #type#
        </isNotNull>
        <![CDATA[
            where id=#id#
        ]]>
    </update>

    <!--<delete id="configDAO.delete" parameterClass="int">-->
        <!--<![CDATA[-->
            <!--delete from usp_config where id = #id#-->
        <!--]]>-->
    <!--</delete>-->

</sqlMap>